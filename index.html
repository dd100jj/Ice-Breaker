<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Ice Breaker Gold</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #f0f2f5);
            --card-bg: #ffffff;
            --text-main: #222222;
            --accent-orange: #ff8a65;
            --accent-blue: #4fc3f7;
            --accent-gold: #ffd700;
            --gray-text: #888888;
        }
        body { 
            background-color: var(--tg-bg); 
            color: var(--text-main);
            font-family: 'Pretendard', -apple-system, sans-serif;
            margin: 0; padding: 15px; display: flex; flex-direction: column; gap: 12px;
            overflow-x: hidden;
        }

        /* Animations */
        @keyframes sparkle-anim {
            0% { box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 1px solid transparent; }
            50% { box-shadow: 0 0 20px var(--accent-blue); border: 1px solid var(--accent-blue); }
            100% { box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 1px solid transparent; }
        }
        .sparkle { animation: sparkle-anim 0.6s ease-in-out; }
        .particle { position: absolute; pointer-events: none; width: 8px; height: 8px; background: #b3e5fc; border-radius: 2px; z-index: 100; }

        /* User Header */
        .user-header { display: flex; justify-content: space-between; align-items: center; padding: 5px; }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .level-tag { background: #ffcc80; color: white; padding: 4px 12px; border-radius: 20px; font-weight: bold; font-size: 13px; }
        .user-name { font-size: 20px; font-weight: 800; color: var(--accent-orange); }

        /* Card Layout */
        .card { background: var(--card-bg); border-radius: 15px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .asset-card { position: relative; border: 1px solid transparent; }
        .asset-title { font-size: 13px; font-weight: bold; display: flex; align-items: center; gap: 6px; }
        .asset-amount { font-size: 26px; font-weight: 800; margin-top: 5px; color: #546e7a; }

        /* Mining Main Area */
        .mine-card { align-items: center; text-align: center; gap: 8px; position: relative; }
        .ice-cube { font-size: 85px; margin: 10px 0; cursor: pointer; transition: transform 0.1s; user-select: none; z-index: 10; }
        .ice-cube:active { transform: scale(0.9); }
        .mining-power { font-size: 28px; font-weight: 800; }
        .mining-speed { color: var(--accent-orange); font-weight: bold; font-size: 14px; }
        .next-goal { font-size: 11px; color: var(--gray-text); margin-top: 4px; }

        /* --- Attendance Toggle UI --- */
        .attendance-card { gap: 0; padding: 0; overflow: hidden; }
        .attendance-header { 
            padding: 15px; display: flex; justify-content: space-between; align-items: center; 
            cursor: pointer; background: #fff; border-radius: 15px; z-index: 2;
        }
        .attendance-header:active { background: #f9f9f9; }
        .attendance-header h3 { margin: 0; font-size: 14px; font-weight: 800; }
        .arrow-icon { transition: transform 0.3s; font-size: 12px; color: var(--gray-text); }
        .arrow-icon.open { transform: rotate(180deg); }

        .attendance-body { 
            max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; 
            padding: 0 15px; background: #fff;
        }
        .attendance-body.open { max-height: 500px; padding-bottom: 20px; }

        .grid-30 { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .day-box { 
            aspect-ratio: 1; background: #fdfdfd; border-radius: 12px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            font-size: 9px; font-weight: bold; color: #bbb; border: 1px solid #eee;
            cursor: pointer; transition: all 0.2s;
        }
        .day-box.active { background: var(--accent-blue); color: white; border-color: var(--accent-blue); }
        .day-box.today { border: 2px solid var(--accent-orange); color: var(--accent-orange); background: #fff5f2; }
        .day-box.special { background: #fffde7; border-color: var(--accent-gold); color: #d4af37; }
        .reward-icon { font-size: 13px; margin-bottom: 2px; }

        /* Shop Area */
        .shop-area { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .shop-btn { border: none; border-radius: 12px; padding: 12px; font-weight: bold; color: white; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .btn-blue { background: #42a5f5; }
        .btn-orange { background: #ff7043; }
    </style>
</head>
<body>
    <div class="user-header">
        <div class="user-info">
            <div class="level-tag" id="level-display">‚≠ê LV.1</div>
            <div class="user-name" id="user-name">Gifty</div>
        </div>
    </div>

    <div id="asset-card" class="card asset-card">
        <div class="asset-title">üßä Ice container</div>
        <div class="asset-amount" id="balance">0</div>
    </div>

    <div class="card mine-card" id="mine-container">
        <div class="ice-cube" onclick="mineClick(event)">üßä</div>
        <div class="mining-power" id="mining-power">+ 0.00000</div>
        <div class="mining-speed" id="speed-text">+ 0.00005 / sec</div>
        <div class="next-goal" id="next-level-text">Goal for LV.2: 10 ICE</div>
    </div>

    <div class="card attendance-card">
        <div class="attendance-header" onclick="toggleAttendance()">
            <h3>üìÖ 30-Day Rewards</h3>
            <span id="arrow" class="arrow-icon">‚ñº</span>
        </div>
        <div id="attendance-body" class="attendance-body">
            <div class="grid-30" id="attendance-grid"></div>
        </div>
    </div>

    <div class="shop-area">
        <button class="shop-btn btn-blue" onclick="tgAlert()">üõí UPGRADE</button>
        <button class="shop-btn btn-orange" onclick="tgAlert()">üéÅ SPECIAL</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const userName = tg.initDataUnsafe?.user?.first_name || "User";
        document.getElementById('user-name').innerText = userName;

        let shards = 0;
        let power = 0.00000;
        let level = 1;
        let autoSpeed = 0.00005;
        let speedMultiplier = 1;
        
        const levelMilestones = [0, 10, 30, 70, 150, 300, 600, 1000];

        // [PASSIVE MINING]
        setInterval(() => {
            power += (autoSpeed * speedMultiplier);
            document.getElementById('mining-power').innerText = "+ " + power.toFixed(5);
        }, 1000);

        // [TOGGLE FUNCTION]
        function toggleAttendance() {
            const body = document.getElementById('attendance-body');
            const arrow = document.getElementById('arrow');
            body.classList.toggle('open');
            arrow.classList.toggle('open');
        }

        // [GENERATE GRID]
        const grid = document.getElementById('attendance-grid');
        for(let i=1; i<=30; i++) {
            const box = document.createElement('div');
            box.className = 'day-box';
            if (i % 7 === 0) box.classList.add('special');
            
            let icon = "üßä";
            if (i === 7) icon = "üéÅ";
            if (i === 14) icon = "‚ö°";
            if (i === 21) icon = "üöÄ";
            if (i === 28) icon = "üíé"; // Updated Icon
            
            box.innerHTML = `<span class="reward-icon">${icon}</span>Day ${i}`;
            if (i === 1) {
                box.classList.add('today');
                box.onclick = (e) => { e.stopPropagation(); dailyCheckIn(box, i); };
            }
            grid.appendChild(box);
        }

        function dailyCheckIn(element, day) {
            if (element.classList.contains('active')) return;
            
            let rewardMsg = "Received 1 ICE!";
            let bonus = 1;

            if (day === 7) { bonus = 10; rewardMsg = "Weekly Bonus: +10 ICE!"; }
            else if (day === 14) { 
                speedMultiplier = 2; 
                rewardMsg = "14-Day Flash: 2X Mining Speed (2h)!"; 
                setTimeout(() => { speedMultiplier = 1; updateUI(); }, 7200000);
            }
            else if (day === 21) { 
                autoSpeed += 0.0001; 
                rewardMsg = "21-Day Boost: Permanent Speed Up!"; 
            }
            else if (day === 28) { 
                bonus = 100; 
                rewardMsg = "üíé DIAMOND REWARD: +100 ICE!"; 
            }

            shards += bonus;
            element.classList.remove('today');
            element.classList.add('active');
            
            updateUI();
            triggerSparkle();
            tg.showAlert(`üìÖ Day ${day} Check-in\n\n${rewardMsg}`);
            if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            checkLevelUp();
        }

        function checkLevelUp() {
            if (level < levelMilestones.length && shards >= levelMilestones[level]) {
                level++;
                autoSpeed += 0.00002; 
                updateUI();
                tg.showAlert(`üéâ LEVEL UP! \n\nYou are now LV.${level}.`);
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            }
        }

        function updateUI() {
            document.getElementById('balance').innerText = shards.toLocaleString();
            document.getElementById('level-display').innerText = `‚≠ê LV.${level}`;
            const displaySpeed = (autoSpeed * speedMultiplier).toFixed(5);
            document.getElementById('speed-text').innerText = `+ ${displaySpeed} / sec`;
            
            const nextGoal = level < levelMilestones.length ? levelMilestones[level] : "MAX";
            document.getElementById('next-level-text').innerText = 
                nextGoal === "MAX" ? "Max Level Reached" : `Goal for LV.${level+1}: ${nextGoal} ICE`;
        }

        function mineClick(event) {
            if (power >= 1) {
                let harvest = Math.floor(power);
                shards += harvest;
                power -= harvest;
                updateUI();
                createParticles(event.clientX, event.clientY);
                triggerSparkle();
                if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('heavy');
                checkLevelUp();
            } else {
                tg.showAlert("Collect at least 1 ICE!");
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
            }
        }

        function triggerSparkle() {
            const assetCard = document.getElementById('asset-card');
            assetCard.classList.remove('sparkle');
            void assetCard.offsetWidth; 
            assetCard.classList.add('sparkle');
        }

        function createParticles(x, y) {
            const container = document.getElementById('mine-container');
            for (let i = 0; i < 6; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = (x - 20) + 'px'; p.style.top = (y - 20) + 'px';
                const angle = Math.random() * Math.PI * 2;
                container.appendChild(p);
                p.animate([{ transform: 'translate(0, 0) scale(1)', opacity: 1 }, { transform: `translate(${Math.cos(angle)*40}px, ${Math.sin(angle)*40}px) scale(0)`, opacity: 0 }], { duration: 500 }).onfinish = () => p.remove();
            }
        }

        function tgAlert() { tg.showAlert("üöß Features coming soon!"); }
    </script>
</body>
</html>
