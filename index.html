<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ice Breaker Gold</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.1.3/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.1.3/firebase-firestore-compat.min.js"></script>
    <style>
        /* [ÏïÑÏù¥Ïä§ ÏàòÏ†ïÎ≥∏5] Í∏∞Ï°¥ Ïä§ÌÉÄÏùº Ïú†ÏßÄ (ÏàòÏ†ï ÏóÜÏùå) */
        body { margin: 0; padding: 0; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; user-select: none; }
        #app { width: 100vw; height: 100vh; position: relative; }
        .stat-card { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; font-size: 14px; }
        .ice-display { font-size: 24px; color: #00f2ff; font-weight: bold; }
        .water-display { font-size: 18px; color: #008cff; }
        #mining-area { width: 100%; height: 60%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #ice-container { width: 150px; height: 200px; border: 2px solid #333; position: relative; overflow: hidden; border-radius: 10px; }
        #ice-fill { position: absolute; bottom: 0; width: 100%; background: linear-gradient(to top, #00f2ff, #fff); transition: height 0.5s; }
        .btn-harvest { margin-top: 20px; padding: 15px 40px; font-size: 18px; background: #00f2ff; border: none; border-radius: 30px; color: #000; font-weight: bold; }
        .btn-harvest:disabled { background: #555; color: #aaa; }
    </style>
</head>
<body>
    <div id="app">
        <div class="stat-card">
            <div>ICE Balance: <span id="balance-ice" class="ice-display">0</span></div>
            <div>Water: <span id="balance-water" class="water-display">0</span></div>
            <div>Level: <span id="user-level">1</span></div>
        </div>

        <div id="mining-area">
            <div id="ice-container">
                <div id="ice-fill" style="height: 0%;"></div>
            </div>
            <div id="mining-status">Mining... <span id="current-pot">0</span> / 1,000</div>
            <button id="harvest-btn" class="btn-harvest" onclick="harvestIce()">HARVEST ICE</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // [ÏïÑÏù¥Ïä§ ÏàòÏ†ïÎ≥∏5] Ïú†Ï†Ä Ïã§Î™Ö Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ (ÏàòÏ†ïÎêú Î∂ÄÎ∂Ñ)
        const user = tg.initDataUnsafe?.user;
        const userId = user?.id || "unknown_user";
        const userName = user?.first_name || "Guest";
        const userLastName = user?.last_name || "";
        const fullTelegramName = `${userName} ${userLastName}`.trim(); // "Ïù¥Î¶Ñ ÏÑ±" ÌòïÌÉú

        // Firebase ÏÑ§Ï†ï (ÏÇ¨Ïö©ÏûêÎãòÏùò ÏÑ§Ï†ïÍ∞í Ïú†ÏßÄ)
        const firebaseConfig = { /* ÏÇ¨Ïö©ÏûêÎãòÏùò Firebase ConfigÎ•º Ïó¨Í∏∞Ïóê Ïú†ÏßÄÌïòÏÑ∏Ïöî */ };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let userData = {
            ice: 0,
            water: 0,
            level: 1,
            pot: 0,
            lastUpdate: Date.now()
        };

        // Îç∞Ïù¥ÌÑ∞ Î°úÎìú Î∞è Ï†ÄÏû• Î°úÏßÅ (ÏïÑÏù¥Ïä§ ÏàòÏ†ïÎ≥∏5 Ïú†ÏßÄ)
        async function loadData() {
            const doc = await db.collection("users").doc(userId.toString()).get();
            if (doc.exists) {
                userData = doc.data();
                updateUI();
            } else {
                await db.collection("users").doc(userId.toString()).set(userData);
            }
        }

        // Í¥ÄÎ¶¨Ïûê Ï±ÑÎÑê Î©îÏãúÏßÄ Ï†ÑÏÜ° Ìï®Ïàò (ÏàòÏ†ïÎêú Î∂ÄÎ∂Ñ: Guest ÎåÄÏã† fullTelegramName ÏÇ¨Ïö©)
        async function sendAdminMessage(text) {
            const BOT_TOKEN = "ÏÇ¨Ïö©ÏûêÎãòÏùò_Î¥á_ÌÜ†ÌÅ∞"; // Ïó¨Í∏∞Ïóê Ïã§Ï†ú ÌÜ†ÌÅ∞ Ïú†ÏßÄ
            const CHAT_ID = "ÏÇ¨Ïö©ÏûêÎãòÏùò_Í¥ÄÎ¶¨Ïûê_Ï±ÑÎÑê_ID"; // Ïó¨Í∏∞Ïóê Ïã§Ï†ú ID Ïú†ÏßÄ
            const formattedText = `üë§ User: ${fullTelegramName} (ID: ${userId})\n${text}`;
            
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: CHAT_ID, text: formattedText })
            });
        }

        // Ï∂úÍ∏à ÏöîÏ≤≠ Ìï®Ïàò (Ïú†Ï†Ä Ïã§Î™Ö Î∞òÏòÅ)
        async function requestWithdrawal(amount, wallet) {
            await sendAdminMessage(`üí∞ [Withdrawal Request]\nAmount: ${amount} ICE\nWallet: ${wallet}`);
            alert("Withdrawal request sent to admin!");
        }

        // ÏõåÌÑ∞ ÏûÖÍ∏à ÏïåÎ¶º Ìï®Ïàò (Ïú†Ï†Ä Ïã§Î™Ö Î∞òÏòÅ)
        async function notifyDeposit(txid, packageInfo) {
            await sendAdminMessage(`üíß [Water Deposit Info]\nPackage: ${packageInfo}\nTXID: ${txid}`);
            alert("Deposit info sent! Admin will verify soon.");
        }

        // Ï±ÑÍµ¥ Î°úÏßÅ (1,000Í∞ú Ï†úÌïú Îì± ÏïÑÏù¥Ïä§ ÏàòÏ†ïÎ≥∏5 Ïú†ÏßÄ)
        function startMining() {
            setInterval(() => {
                if (userData.pot < 1000) {
                    const speed = 0.00005 + (userData.level * 0.00001); // Î†àÎ≤®Î≥Ñ ÏÜçÎèÑ Î∞òÏòÅ
                    userData.pot = Math.min(1000, userData.pot + speed);
                    updateUI();
                }
            }, 1000);

            // 1Î∂Ñ ÏûêÎèô Ï†ÄÏû• (ÏïÑÏù¥Ïä§ ÏàòÏ†ïÎ≥∏5 Ïú†ÏßÄ)
            setInterval(saveData, 60000);
        }

        function harvestIce() {
            if (userData.pot >= 1) {
                userData.ice += Math.floor(userData.pot);
                userData.pot = 0;
                saveData();
                updateUI();
            }
        }

        function updateUI() {
            document.getElementById('balance-ice').innerText = Math.floor(userData.ice).toLocaleString();
            document.getElementById('balance-water').innerText = userData.water;
            document.getElementById('user-level').innerText = userData.level;
            document.getElementById('current-pot').innerText = Math.floor(userData.pot);
            document.getElementById('ice-fill').style.height = (userData.pot / 10) + '%';
            document.getElementById('harvest-btn').disabled = userData.pot < 1;
        }

        async function saveData() {
            await db.collection("users").doc(userId.toString()).update(userData);
        }

        window.onload = () => {
            loadData();
            startMining();
        };
    </script>
</body>
</html>
